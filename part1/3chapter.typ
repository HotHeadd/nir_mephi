= Формирование требований к инструменту
В предыдущих главах были определены ключевые потребности и типовые задачи, решаемые с помощью инструмента мониторинга памяти. На основе анализа задач мониторинга доступа к памяти и обзора существующих решений (проведённых в предыдущих главах) выделены три типа требований: пользовательские, функциональные и эксплуатационные. Каждый тип охватывает свой аспект. Пользовательские требования отражают потребности и ожидания конечных пользователей относительно возможностей инструмента. Функциональные требования детализационно описывают, какие конкретные функции и характеристики должен реализовать инструмент, чтобы удовлетворить пользовательские потребности. Эксплуатационные требования устанавливают внешние условия применения и ограничения, в рамках которых инструмент должен функционировать. Такая структура позволяет перейти от высокоуровневых целей к конкретным спецификациям и учесть контекст использования инструмента.

== Пользовательские требования
Пользовательские требования определяют, какие задачи должен решать инструмент мониторинга памяти с точки зрения пользователя. Эти требования выведены из анализа практических задач мониторинга и ограничения современных средств. Ниже перечислены основные потребности:

*Мониторинг операций доступа к памяти*. Инструмент должен отслеживать фундаментальные операции доступа в адресном пространстве процесса – чтение, запись и исполнение. Это позволит пользователю фиксировать все важные события, связанные с памятью целевого процесса, в реальном времени.

*Контекстная фильтрация событий*. Инструмент должен обеспечивать возможность фильтрации наблюдаемых событий по контексту выполнения. В частности, пользователь должен иметь возможность отбирать события по конкретному потоку выполнения, загруженному модулю или библиотеке, инициирующему системному вызову и диапазону виртуальных адресов памяти. Такая фильтрация поможет сосредоточиться на наиболее релевантных данных и уменьшить объем лишней информации.

*Атрибуция событий к контексту*. Инструмент должен предоставлять для каждого зафиксированного события доступа к памяти информацию о его контексте: например, идентификатор потока и модуля, в котором произошло событие, адрес или диапазон адресов, тип операции (read/write/execute) и при необходимости связанный системный вызов. Наличие контекстной информации для каждого события повышает интерпретируемость результатов и позволяет пользователю связывать обнаруженные аномалии с конкретными частями программы.

*Отсутствие необходимости модификации приложения*. Инструмент должен работать без требовательности изменения исходного кода или бинарного файла отслеживаемого приложения. Пользовательское программное обеспечение, для которого проводится мониторинг, не должно требовать встроенной поддержки или специальной компиляции – инструмент должен подключаться к уже скомпилированному приложению внешними средствами (например, через механизмы операционной системы), не нарушая его работу.

*Конфигурируемость и удобство использования*. Инструмент должен предоставлять понятный способ указать целевой процесс для мониторинга и задать необходимые параметры наблюдения. Пользователь должен иметь возможность легко запустить или остановить мониторинг, а также настроить критерии фильтрации (например, через командную строку или файл конфигурации) без сложной ручной настройки в исходном коде инструмента.

*Понятный вывод данных*. Результаты мониторинга должны предоставляться в формате, удобном для анализа. Инструмент должен выводить собранные события в ясном виде – например, в виде журнала (лог-файла) или консольного отчета, где по каждой операции указаны ее параметры и контекст. Это позволит пользователю проанализировать последовательность событий, выявить аномальные паттерны доступа и соотнести их с выполняемой программой.


== Функциональные требования
Функциональные требования фиксируют наблюдаемое поведение и возможности инструмента мониторинга памяти, необходимые для реализации сформулированных пользовательских запросов. Ниже приведён перечень основных функциональных требований к разрабатываемому инструменту:

*Регистрация событий активности памяти*. Инструмент должен регистрировать события выбранного класса активности памяти целевого процесса в режиме online. Под классом активности памяти понимается тип наблюдаемых событий, определяющий гранулярность и семантику регистрации (например, события модификации страниц, обращения к заданным диапазонам, изменения карты виртуальной памяти и т.п.). События должны регистрироваться с сохранением их порядка возникновения и с возможностью последующего вывода в потоковом режиме или сохранения в файл. Поддержка регистрации событий, связанных с попытками исполнения из выбранных регионов памяти, допускается как расширение.

*Состав и структура записи о событии*. Для каждого зарегистрированного события инструмент должен формировать запись фиксированного формата. Запись о событии должна включать: идентификатор процесса, виртуальный адрес события или границы диапазона (если событие агрегировано по диапазону), тип события (принадлежность к выбранному классу активности), временную метку или порядковый номер события, идентификатор потока, привязку адреса к области виртуальной памяти (модуль/сегмент/регион), если такая привязка определяется.

*Фильтрация по идентификатору потока*. Инструмент должен предоставлять возможность фильтрации событий по идентификатору потока исполнения целевого процесса. При включённой фильтрации инструмент должен регистрировать и/или выводить только те события, которые относятся к указанному набору идентификаторов потоков.

*Фильтрация по модулю программы или области памяти*. Инструмент должен предоставлять фильтрацию событий по принадлежности адреса события к заданному модулю (например, загруженной библиотеке) или к заданной области виртуальной памяти. Пользователь должен иметь возможность задавать критерий фильтрации как: имя/идентификатор модуля или диапазон виртуальных адресов или тип области виртуальной памяти (например, стек, куча), если такая классификация поддерживается выбранным способом определения регионов. Инструмент должен сопоставлять адрес события с описанием регионов виртуальной памяти и применять фильтр согласно заданным условиям.

*Комбинация критериев фильтрации*. Инструмент должен позволять одновременное применение нескольких фильтров. Событие регистрируется и/или выводится тогда и только тогда, когда удовлетворяет всем активным фильтрам (логическое AND). В рамках одного фильтра допускается задание набора значений (логическое OR), например списка потоков, модулей или диапазонов адресов. Это требование направлено на обеспечение максимальной гибкости инструмента, чтобы он мог быть адаптирован под узко определённые случаи использования.

*Режимы запуска*. Инструмент должен поддерживать два режима работы: запуск целевого приложения под контролем инструмента (launch) и подключение к уже запущенному процессу (attach). В обоих режимах мониторинг должен выполняться без модификации и пересборки целевого приложения; инструмент рассматривается как внешнее средство наблюдения, применимое к бинарному файлу или запущенному процессу «как есть».

*Вывод и хранение результатов мониторинга*. Инструмент должен предоставлять результаты наблюдения в удобной форме для анализа. Практически это означает, что собранные события доступа к памяти (после применения всех фильтров) должны быть либо выводимы в консоль/файл в структурированном формате (например, в виде таблицы или журнала с колонками: время, поток, адрес, тип доступа, модуль и пр.), либо доступны через API для последующей обработки. Данный функционал гарантирует, что пользователь сможет проанализировать и использовать собранные данные. Важно предусмотреть, чтобы объём выводимой информации мог быть значительным, поэтому инструмент должен иметь опцию буферизации или сохранения результатов на диск для дальнейшего изучения.

Перечисленные функциональные требования в совокупности описывают поведение инструмента, достаточное для выполнения запросов пользователя. Их реализация позволит решить основную задачу – обеспечить контекстный мониторинг памяти с нужной гибкостью и точностью. Следующим шагом является рассмотрение эксплуатационных требований, накладывающих ограничения и условия на функционирование инструмента.

== Эксплуатационные требования
Эксплуатационные требования отражают внешние условия работы инструмента и ограничения, которые необходимо учесть при его разработке и внедрении. Эти требования дополняют функциональные, гарантируя, что инструмент будет работоспособен в заданном окружении и соответствовать практическим ограничениям. К основным эксплуатационным требованиям относятся:

*Операционная среда.* Инструмент должен функционировать в операционной системе Linux и использовать стандартные механизмы ОС для перехвата и отслеживания событий (например, возможности ptrace, eBPF, tracepoints и др.). Для работы инструмента могут требоваться повышенные привилегии (права администратора), так как мониторинг процессов на уровне ядра и памяти обычно ограничен для непривилегированных пользователей. Инструмент должен быть совместим как с архитектурами x86, так и с ARM.

*Совместимость с целевыми приложениями.* Инструмент должен работать с широким спектром пользовательских приложений, не предъявляя к ним специальных требований. В частности, не предполагается, что целевые программы будут скомпилированы с особыми флагами или запущены в особом режиме; инструмент совместим как с отладочными, так и с релизными сборками приложений. Ограничением (в рамках области исследования) может являться поддержка только пользовательского пространства: то есть мониторинг ядра или драйверов не рассматривается, инструмент работает лишь с адресным пространством обычных процессов.

*Производительность и накладные расходы.* Инструмент должен функционировать с приемлемыми накладными расходами по времени и памяти, чтобы его использование было возможно в реальных сценариях. Под «приемлемыми» понимается, что при активированном мониторинге замедление работы целевого приложения минимально возможное, не изменяющее существенно его поведение. Конкре  тный целевой потолок накладных расходов зависит от выбранных технологий (например, использование чисто программных перехватчиков может давать замедление на порядок, тогда как аппаратная поддержка – на проценты), однако инструмент в любом случае не должен потреблять чрезмерно много ресурсов (ЦП, памяти) или генерировать неподъёмный объём данных. Данное требование соответствует ожиданию более низкой ресурсоёмкости по сравнению с существующими профилировщиками, достигающими аналогичного уровня детализации.

*Надежность и безопасность работы.* Инструмент должен быть устойчивым к сбоям и не нарушать стабильность целевого процесса. В ходе длительного мониторинга не должно происходить утечек ресурсов (например, памяти) или накопления ошибок, способных привести к падению инструмента или приложения. Кроме того, работа инструмента не должна нарушать целостность системы: он не должен вносить изменения в адресное пространство процесса, кроме необходимых для наблюдения, и не должен создавать уязвимостей в безопасности ОС.

Перечисленные эксплуатационные требования обеспечивают соответствие инструмента условиям реального применения. Они гарантируют, что разработанное решение будет работать в заданной программно-аппаратной среде, не нарушая ее ограничений и удовлетворяя практическим критериям по производительности и надёжности.

== Выводы
В данной главе на основе результатов предыдущего анализа были сформированы требования к инструменту мониторинга памяти, разделённые на три категории. Пользовательские требования, выведенные из изученных задач мониторинга и недостатков существующих решений, определяют, какие функции ожидает получить специалист при использовании инструмента. На их основании были получены функциональные требования, детализирующие необходимые механизмы и особенности реализации. Кроме того, сформулированы эксплуатационные требования, отражающие внешние условия работы и ограничения инструмента – среду выполнения, требования к ресурсам и стабильности.

Таким образом, сформированный комплект требований задаёт основу для проектирования архитектуры и последующей разработки инструмента. Пользовательские и функциональные требования обеспечивают ориентиры для реализации ключевых возможностей (контекстная фильтрация, перехват событий и др.), тогда как эксплуатационные требования подчёркивают важность учёта ограничений среды (ОС, аппаратных ресурсов) и требований к эффективности. Выполнение всех указанных требований в совокупности должно привести к созданию инструмента, удовлетворяющего цели исследования и превосходящего по ряду показателей существующие решения мониторинга памяти.
